<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style>
        body{
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: whitesmoke;
        }
        blockquote{
            margin-top: 30px;
        }
        .main{
            margin-top: 30px;
            border: 1px solid #000;
            padding: 10px;
        }
    </style>
</head>
<body>

<div class="main">
    <blockquote class="layui-elem-quote layui-text">
        Some information
    </blockquote>

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>Become a member</legend>
    </fieldset>

    <form class="layui-form" action="">
        <div class="layui-form-item">
            <label class="layui-form-label">username</label>
            <div class="layui-input-inline">
                <input type="text" id="username" name="username" lay-verify="required|username" lay-reqtext="username can't be empty" placeholder="pleases input" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux" id="userInfo"></div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">password</label>
            <div class="layui-input-inline">
                <input type="password" name="password" id="password" lay-verify="pass|required" placeholder="password" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux" >Password should be from 6 to 12</div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label"></label>
            <div class="layui-input-inline">
                <input type="password" name="rpassword" id="rpassword"  autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid layui-word-aux" id="pwdInfo">Pleases confirm your password</div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">phone</label>
                <div class="layui-input-inline">
                    <input type="tel" name="phone" lay-verify="required|phone" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">email</label>
                <div class="layui-input-inline">
                    <input type="text" name="email" lay-verify="email|required" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">address</label>
            <div class="layui-input-block">
                <input type="text" name="address" lay-verify="required" autocomplete="off" placeholder="" class="layui-input">
            </div>
        </div>


        <div class="layui-form-item">
            <div class="layui-input-block">
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="form1">Submit</button>
                <button type="reset" class="layui-btn layui-btn-primary">Reset</button>
            </div>
        </div>

    </form>
</div>


<!-- 示例-970 -->



<script src="/layui/layui.js" charset="utf-8"></script>
<script src="/js/core.util.js" ></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['form', 'layedit', 'laydate','jquery','layer'], function () {
        var form = layui.form
            , layer = layui.layer
            , layedit = layui.layedit
            , laydate = layui.laydate
            , $ = layui.jquery;

        //日期
        laydate.render({
            elem: '#date'
        });
        laydate.render({
            elem: '#date1'
        });
        laydate.render({
            elem: '#start'
        });
        laydate.render({
            elem: '#end'
        });


        form.verify({
            title: function(value){
                if(value.length < 5){
                    return '标题至少得5个字符啊';
                }
            }
            ,pass: [
                /^[\S]{6,12}$/
                ,'The password must be 6-12 digits and no spaces'
            ],
            username: [
                /(?!^[0-9]{6,12}$)(?!^[a-z]{6,12}$)(?!^[A-Z]{6,12}$)^[0-9A-Za-z]{6,12}$/
                ,'Username must have at least 1 uppercase character, lowercase character and one number, and length between 6 - 12s'
            ],
            // myLength:function (value) {
            //     if (value.length > 10 || value.length < 4){
            //         return 'Username length must be between 4 and 10';
            //     }
            // }

        });

        //监听提交
        form.on('submit(form1)', function (data) {
            var json = JSON.stringify(data.field);

                CoreUtil.sendAjax('/api/user/add',json,function (res) {

                    top.layer.msg(res.msg,{icon: 16,time:2000,shade:0.8});

                    setTimeout(function () {
                        window.location.href = "/index/login";
                    }, 2000);

                },'PUT',false);
                console.log(json);


            return false;
        });

        //username失焦检测是否存在
        $("#username").blur(function () {
            //1失去焦点，获得表单输入数据
            //var usernameInput = $(username).val();
            var usernameInput = $(this).val();
            CoreUtil.sendAjax('/api/user/signup/username/' + usernameInput,null,function (res) {
               if (res.data){
                   $('#userInfo').html('<i class="layui-icon" style="color: red;">&#x1006;</i>    username already exists')
               } else{
                   $('#userInfo').html('<i class="layui-icon" style="color: green;">&#xe605;</i> ')
               }
            },'GET',false);

        });

        // 确认密码
        $('#rpassword').blur(function () {

            var pwd = $('#password').val();
            if (pwd !== $(this).val()){
                $('#pwdInfo').html('<i class="layui-icon" style="color: red;">&#x1006;</i> Two passwords are different');
                $(this).val("");
            }else {
                $('#pwdInfo').html('<i class="layui-icon" style="color: green;">&#xe605;</i> ');
            }
        })

    });
</script>

</body>
</html>